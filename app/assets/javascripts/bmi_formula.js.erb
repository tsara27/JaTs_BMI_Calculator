function Capitalize(string)
{
    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase()
}

function WaterNeeds(weightImperial)
{
    return (weightImperial*2/3).toFixed(2);
}

function CalculationBMI(booleanValue, heightMetric, heightImperial, weightMetric, weightImperial)
{
    if (booleanValue == "Metric")
    {
        return (weightMetric/Math.pow((heightMetric/100), 2)).toFixed(2);
    }else if(booleanValue == "Imperial")
    {
        return ((weightImperial/(Math.pow(heightImperial,2))) * 703.06957964).toFixed(2);
    }
}

function YourType(gender, hasil)
{
    if (hasil < 16)
    {
        return "severely underweight";
    }
    else if(hasil > 16 && hasil < 18.6)
    {
        return "underweight";
    }
    else if(gender == "Male" && hasil > 18.5 && hasil <= 25)
    {
        return "healthy";
    }
    else if(gender == "Female" && hasil > 18.5 && hasil <= 24)
    {
        return "healthy";
    }
    else if(gender == "Male" && hasil > 25 && hasil <= 30)
    {
        return "overweight";
    }
    else if(gender == "Female" && hasil > 24 && hasil <= 29)
    {
        return "overweight";
    }
    else if(gender == "Male" && hasil > 30)
    {
        return "obese";
    }
    else if(gender == "Female" && hasil > 29)
    {
        return "obese";
    }

}

function AppViewModel() {
    ko.validation.configure({
        messagesOnModified: true,
        insertMessages: false,
        errorElementClass: 'validationElement',
        decorateElement: true
    });
    this.firstName = ko.observable("").extend({ required: true, 
            pattern: {
                params: /^([a-z ])+$/i,
                message: "Should be filled by alphabets."},
            minLength: 2,
            maxLength: 25
          });

    this.lastName = ko.observable("").extend({ required: true, 
            pattern: {
                params: /^([a-z ])+$/i,
                message: "Should be filled by alphabets."},
            minLength: 1,
            maxLength: 25
          });

    this.booleanValue = ko.observable('Metric');
    this.agePerson = ko.observable(20).extend({ number: true,
            required: true,
            pattern:{
                params: /^([0-9])+$/i,
                message: "Should be filled by number."
            }});

    this.weightMetric = ko.observable(0).extend({ number: true,
            required: true,
            pattern:{
                params: /^([0-9.])+$/i,
                message: "Should be filled by number."
            }});
    this.weightImperial = ko.observable(0).extend({ number: true,
            required: true,
            pattern:{
                params: /^([0-9.])+$/i,
                message: "Should be filled by number."
            }});
    this.heightImperial = ko.observable(0).extend({ number: true,
            required: true,
            pattern:{
                params: /^([0-9.])+$/i,
                message: "Should be filled by number."
            }});
    this.heightMetric = ko.observable(0).extend({ number: true,
            required: true,
            pattern:{
                params: /^([0-9.])+$/i,
                message: "Should be filled by number."
            }});
    this.genders = ko.observableArray(['Male', 'Female']);
    this.chosenGender = ko.observableArray(['Male']);
    
    calcHImp = ko.computed(function() {
        a = (this.heightMetric() * 0.393701).toFixed(2);
        return this.heightImperial(a);
    },this);
    calcHMet =  ko.computed(function() {
        a = (this.heightImperial() * 2.54).toFixed(2);
        return this.heightMetric(a);
    },this);
    calcMImp = ko.computed(function() {
        a = (this.weightMetric() * 2.20462).toFixed(2);
        return this.weightImperial(a);
    },this);
    calcMMet =  ko.computed(function() {
        a = (this.weightImperial() * 0.453592).toFixed(2);
        return this.weightMetric(a);
    },this);
    
    // BEGIN - Metric Limiter
    limitWeightMetric = ko.computed(function() {
    minWeightM = 1;
    maxWeightM = 220;
    if (this.weightMetric() < minWeightM)
    {
        return this.weightMetric(minWeightM);
    }
    else if (this.weightMetric() > maxWeightM)
    {
         return this.weightMetric(maxWeightM);
    }},this);

    limitHeightMetric = ko.computed(function() {
    minHeightM = 1;
    maxHeightM = 250;
    if (this.heightMetric() < minHeightM)
    {
        return this.heightMetric(minHeightM);
    }else if (this.heightMetric() > maxHeightM)
    {
        return this.heightMetric(maxHeightM);
    }
    },this);
    //END - Metric Limiter

    // BEGIN - Imperial Limiter
    limitWeightImperial = ko.computed(function() {
    minWeightI = 2.20;
    maxWeightI = 440;
    if (this.weightImperial() < minWeightI)
    {
        return this.weightImperial(minWeightI);
    }
    else if (this.weightImperial() > maxWeightI)
    {
         return this.weightImperial(maxWeightI);
    }
    },this);

    limitHeightImperial = ko.computed(function() {
    minHeightI = 0.393701;
    maxHeightI = 200;
    if (this.heightImperial() < minHeightI)
    {
        return this.heightImperial(minHeightI);
    }else if (this.heightImperial() > maxHeightI)
    {
        return this.heightImperial(maxHeightI);
    }
    },this);   
    // END - Imperial Limiter
    
    // BEGIN - Age limiter
    limitAge = ko.computed(function() {
    minAge = 1;
    maxAge = 100;
    if (this.agePerson() < minAge)
    {
        return this.agePerson(minAge);
    }else if (this.agePerson() > maxAge)
    {
        return this.agePerson(maxAge);
    }
    },this);
    //END - Age limiter

    this.resultBMI = ko.observable("");
    this.fullName = ko.observable("");
    this.WN = ko.observable("");
    this.waterSuggestion = ko.observable("");
    this.WeightType = ko.observable("");

    this.hasil = ko.computed(function(){
        return CalculationBMI(this.booleanValue(), this.heightMetric(), this.heightImperial(), this.weightMetric(), this.weightImperial());
    },this);

    this.waterNeeds = ko.computed(function(){
        return WaterNeeds(this.weightImperial());
    },this);

    this.genName = ko.computed(function() {
    return "Hello, "+Capitalize(this.firstName()) + " " + Capitalize(this.lastName())+" !";}, this);

    this.genType = ko.computed(function(){
        return  YourType(this.chosenGender(), this.hasil());
    },this);

    this.countBMI = function(){
        if(this.firstName.isValid() == true && this.firstName.isValid() == true && this.agePerson.isValid() == true && this.weightMetric.isValid() == true && this.weightImperial.isValid() == true && this.heightMetric.isValid() == true && this.heightImperial.isValid() == true)
        {
            this.resultBMI("Your BMI is "+this.hasil());
            this.fullName(this.genName());
            this.WeightType(" and you are "+this.genType()+".");
            this.WN("You need "+this.waterNeeds()+" ounces of water a day. Or "+(this.waterNeeds()*0.029573).toFixed(2)+" litres a day.");
            this.waterSuggestion("You may drink 12 ounces or 355 ml of water more every 30 minutes workout.");
        }
        else
        {
            alert('Please check your submission.');
        }
    }

}

ko.applyBindings(new AppViewModel());

